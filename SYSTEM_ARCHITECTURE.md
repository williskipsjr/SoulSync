# ðŸ—ï¸ SoulSync System Architecture

## High-Level Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    USER DEVICE (Desktop)                         â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚             Electron Application                            â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚         Next.js Frontend (Port 3000)                  â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                        â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ Auth Screen  â”‚â†’ â”‚ Mood Dash.   â”‚â†’ â”‚ Chat Dash. â”‚ â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â”‚
â”‚  â”‚  â”‚         â†“                  â†“                 â†“         â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚        Zustand State Management                â”‚  â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ User Data    â€¢ Mood State                   â”‚  â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ Chat Sessions â€¢ UI State                    â”‚  â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                â”‚                                      â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚        localStorage (Browser Storage)          â”‚  â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ User Credentials  â€¢ Chat History            â”‚  â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ Preferences       â€¢ Session Data            â”‚  â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚                            â”‚                                â”‚ â”‚
â”‚  â”‚                            â”‚ HTTP API Calls                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                    â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•
                        NETWORK (HTTP)
                    â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•
                               â”‚
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BACKEND SERVER                                â”‚
â”‚                (Local/Cloud - Port 8000)                         â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚               FastAPI Application                           â”‚ â”‚
â”‚  â”‚                                                             â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚                API Endpoints                         â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                      â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  POST /register_user     - Create user account      â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  POST /register_contact  - Save emergency contact   â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  POST /chat             - AI conversation           â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  POST /alert            - Send crisis notification  â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                      â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚         â”‚                         â”‚                        â”‚ â”‚
â”‚  â”‚         â–¼                         â–¼                        â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚ â”‚
â”‚  â”‚  â”‚  AI Service  â”‚       â”‚   Data Storage     â”‚           â”‚ â”‚
â”‚  â”‚  â”‚              â”‚       â”‚                    â”‚           â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ LLM Model  â”‚       â”‚ soul_users.json    â”‚           â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ Mood Det.  â”‚       â”‚ soul_contacts.json â”‚           â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ Crisis Det.â”‚       â”‚                    â”‚           â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚ â”‚
â”‚  â”‚         â”‚                                                 â”‚ â”‚
â”‚  â”‚         â”‚ Crisis Detected?                                â”‚ â”‚
â”‚  â”‚         â–¼                                                 â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚        Telegram Bot Integration                     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚                                                     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ Retrieves emergency contact                     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ Constructs alert message                        â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ Sends via Telegram Bot API                      â”‚ â”‚ â”‚
â”‚  â”‚  â”‚                                                     â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                             â”‚                             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                    â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•
                      INTERNET (HTTPS)
                    â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•
                               â”‚
                               â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚      Telegram Platform             â”‚
            â”‚                                    â”‚
            â”‚  â€¢ Telegram Bot API                â”‚
            â”‚  â€¢ Message Routing                 â”‚
            â”‚  â€¢ Delivery to Contact             â”‚
            â”‚                                    â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚  Emergency Contact    â”‚
               â”‚  ðŸ“± Receives Alert    â”‚
               â”‚                       â”‚
               â”‚  âš ï¸ SoulSync Alert    â”‚
               â”‚  User: John Doe       â”‚
               â”‚  Condition: suicidal  â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Component Details

### 1. Frontend Application (Electron + Next.js)

#### Components Structure
```
EmailAuthScreen.tsx
â”œâ”€ Login Form
â”‚  â”œâ”€ Email input
â”‚  â”œâ”€ Password input
â”‚  â””â”€ Submit button
â””â”€ Signup Form
   â”œâ”€ Name input
   â”œâ”€ Username input
   â”œâ”€ Email input
   â”œâ”€ Password input
   â”œâ”€ Telegram ID input â­ NEW
   â””â”€ Submit button

MoodDashboard.tsx â­ NEW
â”œâ”€ Day Rating Slider (1-10)
â”œâ”€ Feeling Scale Slider (1-5)
â”œâ”€ Mental Health Tips Carousel
â”‚  â”œâ”€ Exercise tip
â”‚  â”œâ”€ Breathing tip
â”‚  â”œâ”€ Sleep tip
â”‚  â””â”€ Social connection tip
â””â”€ Continue button

ChatDashboard.tsx
â”œâ”€ Sidebar
â”‚  â”œâ”€ New Chat button
â”‚  â”œâ”€ Chat History list
â”‚  â””â”€ User Profile section
â””â”€ Main Chat Area
   â”œâ”€ Mood indicator
   â”œâ”€ Messages display
   â”œâ”€ Typing indicator
   â””â”€ Message input
```

#### State Management (Zustand)
```typescript
AuthState {
  user: {
    id: string
    email: string
    name: string
    username: string
    telegram_id: string â­ NEW
  }
  isAuthenticated: boolean
  moodDashboardCompleted: boolean â­ NEW
  currentMood: MoodType
  chatSessions: ChatSession[]
  currentSessionId: string
}
```

---

### 2. Backend API (FastAPI)

#### Endpoint Flow Diagram

**User Registration:**
```
Frontend                Backend                 Storage
   |                       |                       |
   |---POST /register_user-|                       |
   |   {user_id, name,     |                       |
   |    username, email}   |                       |
   |                       |---Save user data----->|
   |                       |    soul_users.json    |
   |<------Success---------|                       |
   |                       |                       |
   |--POST /register_contact-|                     |
   |   {user_id,          |                        |
   |    contact_chatid}   |                        |
   |                      |---Save contact-------->|
   |                      |   soul_contacts.json   |
   |<-----Success---------|                        |
```

**Chat & Crisis Detection:**
```
Frontend                Backend                 AI Service           Telegram
   |                       |                       |                    |
   |-----POST /chat--------|                       |                    |
   |   {user_id, message}  |                       |                    |
   |                       |---Analyze message---->|                    |
   |                       |                       |                    |
   |                       |<--Mood + Response-----|                    |
   |                       |                       |                    |
   |                       |   Crisis detected?    |                    |
   |                       |         YES           |                    |
   |                       |                       |                    |
   |                       |---POST /alert---------|                    |
   |                       |   {user_id,          |                    |
   |                       |    condition}        |                    |
   |                       |                      |                    |
   |                       |--Get emergency contact from storage       |
   |                       |                      |                    |
   |                       |--Construct alert message                  |
   |                       |                      |                    |
   |                       |--Send via Bot API------------------------->|
   |                       |                      |                    |
   |<--Response + mood-----|                      |    Alert delivered |
   |                       |                      |          â†“         |
   |                       |                      |    [Emergency      |
   |                       |                      |     Contact]       |
```

---

## Data Flow Sequences

### 1. New User Registration

```
â”Œâ”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User â”‚        â”‚ Frontend â”‚        â”‚ Backend â”‚
â””â”€â”€â”¬â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
   â”‚                 â”‚                   â”‚
   â”‚ Fill signup formâ”‚                   â”‚
   â”‚ (incl. Telegram)â”‚                   â”‚
   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚
   â”‚                 â”‚                   â”‚
   â”‚                 â”‚ POST /register_user
   â”‚                 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                 â”‚                   â”‚ Save to
   â”‚                 â”‚                   â”‚ soul_users.json
   â”‚                 â”‚<â”€â”€â”€â”€â”€Successâ”€â”€â”€â”€â”€â”€â”‚
   â”‚                 â”‚                   â”‚
   â”‚                 â”‚ POST /register_contact
   â”‚                 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                 â”‚                   â”‚ Save to
   â”‚                 â”‚                   â”‚ soul_contacts.json
   â”‚                 â”‚<â”€â”€â”€â”€â”€Successâ”€â”€â”€â”€â”€â”€â”‚
   â”‚                 â”‚                   â”‚
   â”‚  Show Mood      â”‚                   â”‚
   â”‚  Dashboard      â”‚                   â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚
   â”‚                 â”‚                   â”‚
```

### 2. Daily App Launch

```
â”Œâ”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User â”‚        â”‚ Frontend â”‚        â”‚ Storage  â”‚
â””â”€â”€â”¬â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
   â”‚                 â”‚                   â”‚
   â”‚ Open app        â”‚                   â”‚
   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚
   â”‚                 â”‚                   â”‚
   â”‚                 â”‚ Load user data    â”‚
   â”‚                 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
   â”‚                 â”‚                   â”‚
   â”‚ Authenticated?  â”‚                   â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€YESâ”€â”€â”€â”€â”€â”‚                   â”‚
   â”‚                 â”‚                   â”‚
   â”‚ Reset mood      â”‚                   â”‚
   â”‚ dashboard flag  â”‚                   â”‚
   â”‚                 â”‚                   â”‚
   â”‚ Show Mood       â”‚                   â”‚
   â”‚ Dashboard       â”‚                   â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚
   â”‚                 â”‚                   â”‚
   â”‚ Rate day & feel â”‚                   â”‚
   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚
   â”‚                 â”‚                   â”‚
   â”‚ Click Continue  â”‚                   â”‚
   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚
   â”‚                 â”‚                   â”‚
   â”‚ Show Chat       â”‚                   â”‚
   â”‚ Dashboard       â”‚                   â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚
   â”‚                 â”‚                   â”‚
```

### 3. Crisis Detection & Alert

```
â”Œâ”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User â”‚   â”‚ Frontend â”‚   â”‚ Backend â”‚   â”‚  AI  â”‚   â”‚ Telegram â”‚
â””â”€â”€â”¬â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”¬â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
   â”‚            â”‚               â”‚            â”‚            â”‚
   â”‚ Type       â”‚               â”‚            â”‚            â”‚
   â”‚ concerning â”‚               â”‚            â”‚            â”‚
   â”‚ message    â”‚               â”‚            â”‚            â”‚
   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚               â”‚            â”‚            â”‚
   â”‚            â”‚               â”‚            â”‚            â”‚
   â”‚            â”‚ POST /chat    â”‚            â”‚            â”‚
   â”‚            â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚            â”‚            â”‚
   â”‚            â”‚               â”‚            â”‚            â”‚
   â”‚            â”‚               â”‚ Analyze    â”‚            â”‚
   â”‚            â”‚               â”‚ message    â”‚            â”‚
   â”‚            â”‚               â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚            â”‚
   â”‚            â”‚               â”‚            â”‚            â”‚
   â”‚            â”‚               â”‚ Crisis     â”‚            â”‚
   â”‚            â”‚               â”‚ detected!  â”‚            â”‚
   â”‚            â”‚               â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚            â”‚
   â”‚            â”‚               â”‚            â”‚            â”‚
   â”‚            â”‚               â”‚ Get emergency          â”‚
   â”‚            â”‚               â”‚ contact from           â”‚
   â”‚            â”‚               â”‚ storage                â”‚
   â”‚            â”‚               â”‚            â”‚            â”‚
   â”‚            â”‚               â”‚ Send alert â”‚            â”‚
   â”‚            â”‚               â”‚ via Bot APIâ”‚            â”‚
   â”‚            â”‚               â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚            â”‚               â”‚            â”‚            â”‚
   â”‚            â”‚               â”‚            â”‚  Deliver   â”‚
   â”‚            â”‚               â”‚            â”‚  to contactâ”‚
   â”‚            â”‚               â”‚            â”‚            â”‚
   â”‚            â”‚<â”€Responseâ”€â”€â”€â”€â”€â”‚            â”‚            â”‚
   â”‚<â”€â”€â”€Showâ”€â”€â”€â”€â”‚               â”‚            â”‚            â”‚
   â”‚   message  â”‚               â”‚            â”‚            â”‚
   â”‚            â”‚               â”‚            â”‚            â”‚
```

---

## Technology Stack Details

### Frontend Dependencies

```json
{
  "dependencies": {
    "@supabase/supabase-js": "^2.39.0",  // Auth helper (optional)
    "axios": "^1.6.0",                    // HTTP client
    "next": "^14.1.0",                    // React framework
    "react": "^18.2.0",                   // UI library
    "react-dom": "^18.2.0",               // React DOM
    "zustand": "^4.5.0"                   // State management
  },
  "devDependencies": {
    "@types/node": "^20.10.0",
    "@types/react": "^18.2.0",
    "electron": "^28.0.0",                // Desktop framework
    "electron-builder": "^24.9.0",        // App packaging
    "typescript": "^5.3.0",               // Type safety
    "tailwindcss": "^3.4.0"               // Styling
  }
}
```

### Backend Dependencies

```python
# requirements.txt
fastapi          # Web framework
uvicorn          # ASGI server
pydantic         # Data validation
requests         # HTTP library for Telegram
```

---

## Security Architecture

### Data Privacy Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    LOCAL DEVICE                          â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚           localStorage                              â”‚ â”‚
â”‚  â”‚  â€¢ User credentials (hashed)                        â”‚ â”‚
â”‚  â”‚  â€¢ Full chat history                                â”‚ â”‚
â”‚  â”‚  â€¢ Session data                                     â”‚ â”‚
â”‚  â”‚  â€¢ Preferences                                      â”‚ â”‚
â”‚  â”‚                                                      â”‚ â”‚
â”‚  â”‚  âœ… Never leaves device                             â”‚ â”‚
â”‚  â”‚  âœ… User controls data                              â”‚ â”‚
â”‚  â”‚  âœ… Can clear anytime                               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
           Only user_id and message sent
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BACKEND SERVER                        â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚           soul_users.json                           â”‚ â”‚
â”‚  â”‚  â€¢ user_id (UUID)                                   â”‚ â”‚
â”‚  â”‚  â€¢ username                                         â”‚ â”‚
â”‚  â”‚  â€¢ name                                             â”‚ â”‚
â”‚  â”‚  â€¢ email                                            â”‚ â”‚
â”‚  â”‚                                                      â”‚ â”‚
â”‚  â”‚  âŒ NO passwords stored                             â”‚ â”‚
â”‚  â”‚  âŒ NO chat history stored                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚           soul_contacts.json                        â”‚ â”‚
â”‚  â”‚  â€¢ user_id â†’ telegram_chat_id mapping              â”‚ â”‚
â”‚  â”‚                                                      â”‚ â”‚
â”‚  â”‚  âš ï¸  Only for emergency alerts                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Alert Privacy

```
User's Message            Backend Storage           Alert Sent
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€            â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€           â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
"I want to end            NOT STORED                "User: John Doe
 it all, I can't                                     Condition: suicidal
 take this anymore"        Only:                     
                          - user_id                  SoulSync detected
Full message             - mood type                possible distress"
analyzed but             - timestamp                
NEVER stored                                        Generic wellness
                                                    check message
```

---

## Deployment Architecture

### Development Setup (Current)

```
[Developer Machine]
    â”‚
    â”œâ”€â”€â”€ Frontend (localhost:3000)
    â”‚    Electron + Next.js
    â”‚
    â””â”€â”€â”€ Backend (localhost:8000)
         FastAPI Server
```

### Production Setup (Recommended)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 User's Computer                      â”‚
â”‚                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚        Electron Desktop App                     â”‚ â”‚
â”‚  â”‚        (Packaged .exe / .dmg / .AppImage)      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                   HTTPS (Secure)
                            â”‚
                            â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚        Cloud Server / VPS           â”‚
      â”‚                                      â”‚
      â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
      â”‚  â”‚  FastAPI Backend             â”‚  â”‚
      â”‚  â”‚  (Port 443/HTTPS)            â”‚  â”‚
      â”‚  â”‚                              â”‚  â”‚
      â”‚  â”‚  â€¢ SSL/TLS Encryption        â”‚  â”‚
      â”‚  â”‚  â€¢ Rate Limiting             â”‚  â”‚
      â”‚  â”‚  â€¢ CORS Protection           â”‚  â”‚
      â”‚  â”‚  â€¢ Authentication            â”‚  â”‚
      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
      â”‚                                     â”‚
      â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
      â”‚  â”‚  Database (PostgreSQL)       â”‚  â”‚
      â”‚  â”‚  (Encrypted at rest)         â”‚  â”‚
      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â”‚ Telegram Bot API
                     â–¼
            [Telegram Platform]
```

---

## Mood Detection Flow

```
User Message
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   LLM Analysis Engine     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Sentiment Analysis      â”‚
â”‚ â€¢ Keyword Detection       â”‚
â”‚ â€¢ Context Understanding   â”‚
â”‚ â€¢ Pattern Recognition     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Mood Classification     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Normal      ðŸ˜Š            â”‚
â”‚ Depression  ðŸ˜”            â”‚
â”‚ Suicidal    ðŸŒ¸            â”‚
â”‚ Anxiety     ðŸ˜°            â”‚
â”‚ Bipolar     ðŸŒ€            â”‚
â”‚ Stress      ðŸ˜¥            â”‚
â”‚ Personality ðŸ§             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                      â”‚
          â–¼                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  UI Adaptation   â”‚   â”‚ Crisis Detection   â”‚
â”‚                  â”‚   â”‚                    â”‚
â”‚ â€¢ Change colors  â”‚   â”‚ Threshold met?     â”‚
â”‚ â€¢ Update emoji   â”‚   â”‚      YES           â”‚
â”‚ â€¢ Adjust tone    â”‚   â”‚       â†“            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ Trigger /alert     â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## File Storage Structure

### Frontend (localStorage)

```javascript
// Key: soulsync-storage
{
  "user": {
    "id": "user_1234567890_abc123",
    "email": "john@example.com",
    "name": "John Doe",
    "username": "johndoe",
    "telegram_id": "123456789"
  },
  "isAuthenticated": true,
  "moodDashboardCompleted": false,
  "currentMood": "normal",
  "chatSessions": [
    {
      "id": "session_1234567890_xyz789",
      "title": "Feeling anxious today...",
      "messages": [
        {
          "id": "msg_1234567890_aaa111",
          "role": "user",
          "content": "I'm feeling anxious",
          "timestamp": 1704067200000
        },
        {
          "id": "msg_1234567891_bbb222",
          "role": "assistant",
          "content": "I hear that you're feeling anxious...",
          "timestamp": 1704067201000
        }
      ],
      "createdAt": 1704067200000,
      "updatedAt": 1704067201000
    }
  ],
  "currentSessionId": "session_1234567890_xyz789"
}
```

### Backend (JSON Files)

```javascript
// soul_users.json
{
  "user_1234567890_abc123": {
    "username": "johndoe",
    "name": "John Doe",
    "email": "john@example.com"
  }
}

// soul_contacts.json
{
  "user_1234567890_abc123": {
    "user_name": "John Doe",
    "contact_chatid": "123456789"
  }
}
```

---

This architecture ensures:
- âœ… **Privacy**: Sensitive data stays local
- âœ… **Performance**: Fast responses with local storage
- âœ… **Reliability**: Offline mode available
- âœ… **Scalability**: Backend can handle multiple users
- âœ… **Security**: Minimal data transmission
- âœ… **Safety**: Automatic crisis intervention
